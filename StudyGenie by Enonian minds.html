<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Summarizer & Quiz Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            min-height: 150px;
            transition: border 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }

        .btn-summarize {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-summarize:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-quiz {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-quiz:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(245, 87, 108, 0.3);
        }

        .btn-diagram {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-diagram:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .result-section {
            display: none;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .result-box h2 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .topics-list {
            list-style: none;
            padding-left: 0;
        }

        .topics-list li {
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #764ba2;
        }

        .quiz-section {
            display: none;
        }

        .diagram-section {
            display: none;
        }

        .question-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .option.selected {
            border-color: #667eea;
            background: #e7eaf6;
        }

        .option.correct {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .option.wrong {
            border-color: #f44336;
            background: #ffebee;
        }

        .submit-quiz {
            width: 100%;
            margin-top: 20px;
        }

        .score {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-top: 20px;
        }

        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            font-size: 18px;
            margin: 20px 0;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .diagram-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            overflow-x: auto;
            min-height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #diagramContainer {
            width: 100%;
            text-align: center;
        }

        .mermaid svg {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìö StudyGenie</h1>
        <p class="subtitle">Summarize, Extract Topics, Generate Quiz & Visual Flowcharts</p>

        <div class="input-section">
            <label for="inputText">Enter Your Text:</label>
            <textarea id="inputText" placeholder="Paste your text here... (articles, notes, documents, etc.)"></textarea>
        </div>

        <div class="button-group">
            <button class="btn-summarize" onclick="summarizeText()">üìù Summarize & Extract Topics</button>
            <button class="btn-quiz" onclick="generateQuiz()">üéØ Generate Quiz</button>
            <button class="btn-diagram" onclick="generateFlowchart()">üé® Create Flowchart</button>
        </div>

        <div class="loading" id="loading">Processing</div>

        <div class="result-section" id="resultSection">
            <div class="result-box">
                <h2>üìÑ Summary</h2>
                <p id="summary"></p>
            </div>

            <div class="result-box">
                <h2>üîë Key Topics</h2>
                <ul class="topics-list" id="topics"></ul>
            </div>
        </div>

        <div class="quiz-section" id="quizSection">
            <div class="result-box">
                <h2>üéØ Quiz Time!</h2>
                <div id="quizContainer"></div>
                <button class="btn-quiz submit-quiz" onclick="submitQuiz()" id="submitBtn" style="display:none;">Submit Quiz</button>
                <div class="score" id="score"></div>
            </div>
        </div>

        <div class="diagram-section" id="diagramSection">
            <div class="result-box">
                <h2>üé® Visual Flowchart</h2>
                <p style="color: #666; margin-bottom: 15px;">A beautiful visual representation of your text</p>
                <div class="diagram-container">
                    <div id="diagramContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. SET YOUR GEMINI API KEY HERE ---
        // IMPORTANT: Replace the placeholder with your actual key.
        const GEMINI_API_KEY = 'AIzaSyA_UUQ-cIr1drIEGDa9DthZ-Lkco12WBTM';
        // ---------------------------------------
        
        // Initialize Mermaid with better config
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        let quizData = [];
        let userAnswers = {};

        // --- Core Gemini API Call Function ---
        async function callGeminiApi(prompt) {
            const apiKey = GEMINI_API_KEY;
            
            if (apiKey === 'YOUR_GEMINI_API_KEY_HERE' || !apiKey) {
                alert('Please update the GEMINI_API_KEY variable in the script block with your actual key!');
                return null;
            }

            const GEMINI_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro:generateContent';

            try {
                const response = await fetch(`${GEMINI_URL}?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            role: 'user',
                            parts: [{ text: prompt }]
                        }],
                        // CORRECT FIELD NAME: Must be 'generationConfig' for REST API
                        generationConfig: { 
                            temperature: 0.1,
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error ? errorData.error.message : response.statusText);
                }

                const data = await response.json();
                
                // Extract the text part from the response
                const textContent = data.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!textContent) {
                    throw new Error('Gemini API returned an empty response.');
                }
                
                return textContent.trim();
            } catch (error) {
                console.error('Gemini API Call Error:', error);
                alert('API Error: ' + error.message);
                return null;
            }
        }

        async function summarizeText() {
            const text = document.getElementById('inputText').value.trim();
            
            if (!text) {
                alert('Please enter some text first!');
                return;
            }

            showLoading(true);
            hideResults();
            document.getElementById('resultSection').style.display = 'block'; // Show section for content to be inserted

            const prompt = `Please analyze this text and provide:
1. A concise summary (2-3 sentences)
2. 5-7 key topics/points

Text: ${text}

Format your response as a single valid JSON object:
{
  "summary": "summary here",
  "topics": ["topic1", "topic2", ...]
}`;

            const content = await callGeminiApi(prompt);
            
            showLoading(false);
            if (!content) return;

            try {
                // Find and parse the JSON block
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                const jsonString = jsonMatch ? jsonMatch[0] : content;
                const result = JSON.parse(jsonString);
                displayResults(result);
            } catch (error) {
                alert('Error parsing JSON response: ' + error.message + '\nRaw content:\n' + content);
                document.getElementById('summary').textContent = 'Could not parse summary/topics.';
                document.getElementById('topics').innerHTML = '';
            }
        }

        async function generateQuiz() {
            const text = document.getElementById('inputText').value.trim();
            
            if (!text) {
                alert('Please enter some text first!');
                return;
            }

            showLoading(true);
            hideResults();

            const prompt = `Generate 5 multiple choice questions based on this text. Each question should have 4 options with one correct answer. The correct property must be the zero-based index of the correct answer in the options array.

Text: ${text}

Format as a single valid JSON object with a "questions" array:
{
  "questions": [
    {
      "question": "question text",
      "options": ["Option A", "Option B", "Option C", "Option D"],
      "correct": 0
    }
  ]
}`;

            const content = await callGeminiApi(prompt);
            
            showLoading(false);
            if (!content) return;

            try {
                // Find and parse the JSON block
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                const jsonString = jsonMatch ? jsonMatch[0] : content;
                const result = JSON.parse(jsonString);

                if (result.questions && Array.isArray(result.questions)) {
                    displayQuiz(result.questions);
                } else {
                     alert('Error: Quiz format not correct.');
                }
            } catch (error) {
                alert('Error parsing JSON response: ' + error.message + '\nRaw content:\n' + content);
            }
        }

        async function generateFlowchart() {
            const text = document.getElementById('inputText').value.trim();
            
            if (!text) {
                alert('Please enter some text first!');
                return;
            }

            showLoading(true);
            hideResults();
            document.getElementById('diagramSection').style.display = 'block'; // Show section now to place loading indicator

            const prompt = `Create a simple and clear Mermaid flowchart for this text. Focus on the main sequence of steps, concepts, or decisions.

Text: ${text}

Rules:
1. Start with "flowchart TD" (top to down)
2. Use simple node IDs like A, B, C, etc.
3. Keep labels short (3-5 words max)
4. Use these shapes:
   - A[Rectangle] for steps/concepts
   - B(Rounded) for processes 
   - C{Diamond} for decisions
5. Connect with arrows like: A --> B
6. Respond with ONLY the raw mermaid code, no prose, no JSON, and no code block delimiters (\`\`\`).`;

            let code = await callGeminiApi(prompt);
            
            showLoading(false);
            if (!code) return;

            // Simple cleaning just in case the model adds unwanted markers
            code = code.replace(/```mermaid/g, '').replace(/```/g, '').trim();
            
            console.log('Mermaid Code:', code);
            
            await displayFlowchart(code);
        }

        async function displayFlowchart(code) {
            const container = document.getElementById('diagramContainer');
            
            try {
                // Clear previous content
                container.innerHTML = '';
                
                // Create a new div for mermaid
                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = code;
                container.appendChild(mermaidDiv);
                
                // Render with mermaid
                await mermaid.run({
                    querySelector: '.mermaid'
                });
                
            } catch (error) {
                console.error('Mermaid Error:', error);
                container.innerHTML = `
                    <div style="padding: 30px; text-align: center;">
                        <div style="color: #f44336; font-size: 18px; margin-bottom: 10px;">‚ö†Ô∏è Mermaid Rendering Failed</div>
                        <div style="color: #666;">Raw code: <pre>${code}</pre></div>
                    </div>
                `;
            }
        }

        function displayResults(result) {
            document.getElementById('summary').textContent = result.summary;
            
            const topicsList = document.getElementById('topics');
            topicsList.innerHTML = '';
            // Ensure result.topics is an array before trying to iterate
            if (Array.isArray(result.topics)) {
                result.topics.forEach(topic => {
                    const li = document.createElement('li');
                    li.textContent = topic;
                    topicsList.appendChild(li);
                });
            }

            document.getElementById('resultSection').style.display = 'block';
        }

        function displayQuiz(questions) {
            quizData = questions;
            userAnswers = {};
            
            const container = document.getElementById('quizContainer');
            container.innerHTML = '';

            questions.forEach((q, index) => {
                const card = document.createElement('div');
                card.className = 'question-card';
                
                const questionText = document.createElement('div');
                questionText.className = 'question-text';
                questionText.textContent = `${index + 1}. ${q.question}`;
                card.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'options';

                q.options.forEach((option, optIndex) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.textContent = option;
                    optionDiv.onclick = () => selectOption(index, optIndex, optionDiv);
                    optionsDiv.appendChild(optionDiv);
                });

                card.appendChild(optionsDiv);
                container.appendChild(card);
            });

            document.getElementById('quizSection').style.display = 'block';
            document.getElementById('submitBtn').style.display = 'block';
            document.getElementById('score').textContent = '';
        }

        function selectOption(questionIndex, optionIndex, element) {
            const options = element.parentElement.children;
            for (let opt of options) {
                opt.classList.remove('selected', 'correct', 'wrong'); // Remove validation classes when selecting
            }
            element.classList.add('selected');
            userAnswers[questionIndex] = optionIndex;
        }

        function submitQuiz() {
            let correct = 0;
            const questions = document.querySelectorAll('.question-card');

            questions.forEach((card, index) => {
                const options = card.querySelectorAll('.option');
                const userAnswer = userAnswers[index];
                const correctAnswer = quizData[index].correct;

                options.forEach((opt, optIndex) => {
                    opt.classList.remove('correct', 'wrong'); // Clear previous validation
                    if (optIndex === correctAnswer) {
                        opt.classList.add('correct');
                    }
                    if (userAnswer === optIndex && optIndex !== correctAnswer) {
                        opt.classList.add('wrong');
                    }
                    opt.onclick = null; // Disable further clicking after submission
                });

                if (userAnswer === correctAnswer) {
                    correct++;
                }
            });

            const score = document.getElementById('score');
            score.textContent = `Your Score: ${correct}/${quizData.length} (${Math.round(correct/quizData.length*100)}%)`;
            document.getElementById('submitBtn').style.display = 'none';
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function hideResults() {
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('quizSection').style.display = 'none';
            document.getElementById('diagramSection').style.display = 'none';
        }
    </script>
</body>
</html>